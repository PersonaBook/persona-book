
<!--<div th:fragment="chatbot">-->
<!--<div id="chatbot-window" class="floating-window card shadow" style="display:none; width: 350px; position: fixed; bottom: 100px; right: 24px; z-index: 1060;">-->
<!--  <div class="card-header d-flex justify-content-between align-items-center p-2 bg-info text-white">-->
<!--    <span><i class="fa fa-comments"></i> Live Chat</span>-->
<!--    <div>-->
<!--      <button class="btn btn-sm btn-light me-1" title="Minimize" onclick="windowMinimize('chatbot-window')"><i class="fa fa-minus"></i></button>-->
<!--      <button class="btn btn-sm btn-light me-1" title="Maximize" onclick="windowMaximize('chatbot-window')"><i class="fa fa-square-o"></i></button>-->
<!--      <button class="btn btn-sm btn-light" title="Close" onclick="windowClose('chatbot-window')"><i class="fa fa-times"></i></button>-->
<!--    </div>-->
<!--  </div>-->
<!--  <div class="card-body" style="max-height: 400px; overflow-y: auto;">-->
<!--    <div th:each="msg : ${chatMessages}">-->
<!--      <div th:if="${msg.sender == 'user'}" class="d-flex flex-row justify-content-end mb-4">-->
<!--        <div class="p-3 me-3 border bg-body-tertiary" style="border-radius: 15px;">-->
<!--          <p class="small mb-0" th:text="${msg.content}"></p>-->
<!--        </div>-->
<!--        <img src="/image/user-avatar.png" alt="user" style="width: 45px; height: 100%;">-->
<!--      </div>-->
<!--      <div th:if="${msg.sender == 'bot'}" class="d-flex flex-row justify-content-start mb-4">-->
<!--        <img src="/image/bot-avatar.png" alt="bot" style="width: 45px; height: 100%;">-->
<!--        <div class="p-3 ms-3" style="border-radius: 15px; background-color: rgba(57, 192, 237,.2);">-->
<!--          <p class="small mb-0" th:text="${msg.content}"></p>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
<!--  </div>-->
<!--  <div class="card-footer bg-white">-->
<!--    <form th:action="@{/chat/send}" method="post" class="d-flex align-items-center">-->
<!--      <textarea class="form-control bg-body-tertiary me-2" name="message" rows="1" placeholder="Type your message"></textarea>-->
<!--      <button type="submit" class="btn btn-info text-white"><i class="fa fa-paper-plane"></i></button>-->
<!--    </form>-->
<!--  </div>-->
<!--</div>-->
<!--</div>-->




<!-- fragments/chatbot.html -->
<div th:fragment="chatbot">
  <div id="chatbot-window" class="chat-container floating" style="display: none;">
    <div class="chat-header">
      🤖 학습 도우미 챗봇
      <button type="button" onclick="toggleChatbot()" class="close-btn">×</button>
    </div>

    <div class="chat-settings">
      <button type="button" onclick="deleteChatHistoryAndRestart()" class="quick-btn">채팅 이력 삭제</button>
      <button type="button" id="newChatButton" onclick="startNewChat()" class="quick-btn" style="display: none;">새로운 대화</button>
      <input type="hidden" id="userId" th:value="${book.userId}" />
      <input type="hidden" id="bookId" th:value="${book.bookId}" />
    </div>

    <div class="debug-info">
      상태: <span id="debugState">INITIAL / START</span>
    </div>

    <div class="chat-messages" id="chatMessages"></div>
    <div class="error-message" id="errorMessage"></div>
    <div class="loading" id="loadingIndicator">AI가 응답을 생성하고 있습니다...</div>

    <div class="chat-input-container">
      <form class="chat-input-form" id="chatForm">
        <input type="text" class="chat-input" id="messageInput" placeholder="메시지를 입력하세요..." />
        <button type="submit" class="send-button" id="sendButton">전송</button>
      </form>
    </div>
  </div>
</div>
