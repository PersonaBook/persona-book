<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
    <title th:text="'아이디 찾기' ?: 'PDF-Playground'">Layout</title>
    <script th:src="@{/js/effectiven.js}"></script>
    <script>
        $(document).ready(function() {
            console.log("idInquiry.html: Document ready.");

            $("#form_area").on("submit", function(event) {
                console.log("idInquiry.html: Form submit event fired.");
                event.preventDefault();

                const name = $("#name").val().trim();
                const email = $("#email").val().trim();

                // 입력값 검증
                if (!name) {
                    alert("이름을 입력해주세요.");
                    $("#name").focus();
                    return;
                }

                if (!email) {
                    alert("이메일을 입력해주세요.");
                    $("#email").focus();
                    return;
                }

                console.log("idInquiry.html: Name: " + name + ", Email: " + email);

                // 버튼 비활성화 (중복 클릭 방지)
                $("#formBtn").prop("disabled", true).text("처리중...");

                $.ajax({
                    url: "/find-id-success",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ name: name, email: email }),
                    success: function(response) {
                        console.log("idInquiry.html: AJAX success. Response: ", response);
                        // 로그인 페이지로 이동
                        window.location.href = "/login";
                    },
                    error: function(jqXHR) {
                        console.error("아이디 찾기 실패:", jqXHR.responseText);
                        const errorMessage = jqXHR.responseJSON && jqXHR.responseJSON.message
                            ? jqXHR.responseJSON.message
                            : "아이디 찾기 중 오류가 발생했습니다.";
                        alert(errorMessage);
                    },
                    complete: function() {
                        // 버튼 다시 활성화
                        $("#formBtn").prop("disabled", false).text("아이디 찾기");
                    }
                });
            });
        });
    </script>
</head>



<div layout:fragment="content">
    <div class="container d-flex justify-content-center align-items-center flex-direction-column">
        <div class="col-lg-6 col-12 my-5">
            <div class="w-100">
                <h1 class="fw-bold mb-4 text-center">아이디 찾기</h1>

                <div class="card">
                    <div class="card-body">
                        <form id="form_area" action="/find-id-success" method="post">
                            <div class="mb-3">
                                <label class="form-label" for="name">이름 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="name" name="name" placeholder="이름을 입력해주세요." required >
                                <div class="invalid-feedback" id="nameError"></div>
                                <div class="valid-feedback" id="nameSuccess"></div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label" for="email">이메일 <span class="text-danger">*</span></label>
                                <div class="d-flex gap-2">
                                    <input type="email" class="form-control" id="email" name="email" placeholder="example@email.com" required >
                                    <button type="button" class="btn btn-outline-secondary" id="sendVerificationCodeBtn" style="min-width: 130px;" >인증번호 발송</button>
                                </div>
                                <div class="invalid-feedback" id="emailError"></div>
                                <div class="valid-feedback" id="emailSuccess"></div>
                            </div>

                            <div class="mb-3" id="verificationCodeSection" style="display: none">
                                <label class="form-label" for="verificationCode">인증번호 입력 <span class="text-danger">*</span></label>
                                <div class="d-flex gap-2">
                                    <input class="form-control" id="verificationCode" type="text" placeholder="인증번호를 입력하세요">
                                    <button class="btn btn-outline-primary" id="verifyCodeBtn" type="button" style="min-width: 130px;">인증번호 확인</button>
                                </div>
                                <div class="mt-2" id="codeVerificationMessage"></div>
                            </div>

                            <button type="submit" id="formBtn" class="btn btn-primary w-100 mt-5">아이디 찾기</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</html>